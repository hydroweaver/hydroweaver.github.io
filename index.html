<!-- 1. add using http call 
2. decide on what to show
3. add head title -->

<!--  -->

<!DOCTYPE HTML>
<html>
	<body>
	<head>
		<link rel="stylesheet" type="text/css" href="stylesheet.css" media="screen"/>
	</head>
	</body>
		<p>API Data Explorer</p>
		<div class="buttonDiv">
			<label>Your Cloud Function URL</label>
			<input class = "inputText" id="cloudFunctionURL"></input>
			<br>
			<br>
			<label>Your API Key</label>
			<input class = "inputText" id="apikey"></input>
			<br>
			<br>
			<label>Your Client ID</label>
			<input class = "inputText" id="clientid"></input>
			<br>
			<br>
			<label>Your Client Secret</label>
			<input class = "inputText" id="clientSecret"></input>
			<br>
			<br>
			<button class = "buttonclass" id = "authAndLoadButton" onclick="authAndLoad()">Authorize & Load</button>
			<button class = "buttonclass" id = "executeButton" onclick="execute()">Call API</button>
		</div>
		<br>
		<br>
		<div id="fetchUpdateDiv"></div>
		<script>
			
			let div = document.getElementById("fetchUpdateDiv");
			let body = {};
			
			function authAndLoad(){
				let result = validateForms();

				if(result){
					div.innerHTML = "";
					let loaderDiv = document.createElement("div");
					loaderDiv.className = "loader";
					document.body.insertAdjacentElement('afterend', loaderDiv);
					fetch(document.getElementById("cloudFunctionURL").value.toString(),{
					// fetch("http://localhost:8000",{
						method: 'POST',
						// headers have to be added as new headers!
						headers: new Headers(
							{
								'Content-Type': 'application/json',
								// https://stackoverflow.com/questions/1256593/why-am-i-getting-an-options-request-instead-of-a-get-request
								// this fixed our problem, changing from "application/json" to "text/plain" stopped the horrible options request â€“ Keeno Jul 12 '13 at 9:44
								// the two below did nothing! Might want to setup this in function
								// 'Access-Control-Allow-Methods': 'POST',
    							// 'Access-Control-Allow-Headers': 'Content-Type'
							}),
						body: JSON.stringify(body),
						mode: 'cors'
					})
					.then((response)=>{
						// had to use response.text and not response.json since server sending response as text/html
						return response.text();
					// fetch promise needs to be resolved to get the server response
						}).then((jsonload)=>{
							resetTextColor();
							loaderDiv.remove();
							resetTextColor();
							div.innerHTML = jsonload;
						}).catch((err)=>{
							resetTextColor();
							loaderDiv.remove();
							// loaderDiv.style.display = "none";
							div.innerHTML = err;
						});
				}
			}

			function validateForms(){
				let apikey = document.getElementById("apikey").value;
				let clientid = document.getElementById("clientid").value;
				let clientSecret = document.getElementById("clientSecret").value;

				if(apikey == '' || clientid == '' ||  clientSecret == ''){
					div.innerHTML = "Error!";
					div.style.color = "red";
					return false;
				}
				else{
					body = {
						key : apikey,
						id : clientid,
						secret : clientSecret
					}
					return true;
				}
			}

			function execute(){
				div.innerHTML = "API Called";
				resetTextColor();
			}

			function resetTextColor(){
				div.style.color = "";
			}

		</script>
		<br></br>
</html>
